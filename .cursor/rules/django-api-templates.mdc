---
description: Django conventions for API-first pages with templates
alwaysApply: true
---

# Django API + Templates Rule

- Keep business logic in services/utils, not in views or templates.
- Views should be thin: validate input, call service layer, return response.
- For JSON endpoints, prefer explicit serializers/schemas and stable response shapes.
- Use class-based views or DRF views consistently per module.
- Never expose secrets, tokens, or private fields in API payloads.

## Template and tag guidance

- Templates are for presentation only; avoid complex conditions and heavy loops.
- Move reusable template behavior to inclusion tags or simple custom tags.
- If a tag needs database access, cache or prefetch in the view when possible.
- Keep HTML partials small and composable (header, footer, card, list item).

## Data and performance

- Prevent N+1 queries with `select_related` / `prefetch_related`.
- Paginate large lists and filter/sort on the backend.
- Add tests for endpoint contracts (status code, payload keys, permissions).

## Example

```python
# Good: thin view that delegates work
def project_list_api(request):
    data = project_service.list_public_projects(user=request.user)
    return JsonResponse({"projects": data}, status=200)
```
